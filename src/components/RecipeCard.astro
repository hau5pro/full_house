---
import type { CollectionEntry } from "astro:content";
import { CDN_BASE } from "../config";
import TagChips from "./TagChips.astro";

interface Props {
  recipe: CollectionEntry<"recipes">;
  priority?: boolean;
}

const { recipe, priority = false } = Astro.props;
---

<a href={`/recipes/${recipe.id}`} class="recipe-card-link" aria-label={`View recipe: ${recipe.data.title}`}>
  <article class="recipe-card">
    {recipe.data.image && (
      <img
        src={`${CDN_BASE}/${recipe.data.image}`}
        alt={recipe.data.title}
        class="recipe-card-image"
        loading={priority ? "eager" : "lazy"}
        fetchpriority={priority ? "high" : "auto"}
        transition:name={`recipe-img-${recipe.id.replace(/\//g, "-")}`}
        transition:animate="fade"
      />
    )}
    <div class="recipe-card-content">
      <h3 class="recipe-card-title" transition:name={`recipe-title-${recipe.id.replace(/\//g, "-")}`}>{recipe.data.title}</h3>
      {recipe.data.description && (
        <p class="recipe-card-description">
          {recipe.data.description}
        </p>
      )}
      <TagChips tags={recipe.data.tags} limit={3} />
      {recipe.data.meta && (recipe.data.meta.prepTime || recipe.data.meta.cookTime || recipe.data.meta.fermentTime) && (
        <div class="recipe-card-meta">
          {recipe.data.meta.prepTime && (
            <span class="meta-item">
              Prep: {recipe.data.meta.prepTime}
            </span>
          )}
          {recipe.data.meta.cookTime && (
            <span class="meta-item">
              Cook: {recipe.data.meta.cookTime}
            </span>
          )}
          {recipe.data.meta.fermentTime && (
            <span class="meta-item">
              Ferment: {recipe.data.meta.fermentTime}
            </span>
          )}
        </div>
      )}
    </div>
  </article>
</a>
